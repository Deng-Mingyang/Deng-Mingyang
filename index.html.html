<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2028è€ƒç ”å¤‡è€ƒæ—¶é•¿ç»Ÿè®¡ç³»ç»Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* åŸºç¡€æ ·å¼ä¿ç•™ */
        body { background-color: #f5f7f0 !important; }
        .card { box-shadow: 0 2px 8px rgba(100,120,80,0.1); border-radius: 8px; padding: 1.5rem; margin-bottom: 1.5rem; background-color: #ffffff !important; }
        .btn { @apply px-4 py-2 rounded-md text-white font-medium transition-all; }
        .btn-primary { @apply bg-emerald-600 hover:bg-emerald-700; }
        .btn-danger { @apply bg-rose-500 hover:bg-rose-600; }
        .btn-secondary { @apply bg-slate-600 hover:bg-slate-700; }
        .btn-warning { @apply bg-amber-500 hover:bg-amber-600; }
        .input { @apply w-full p-2 border border-emerald-100 rounded-md focus:outline-none focus:ring-2 focus:ring-emerald-400 bg-emerald-50; }
        .countdown-card { background-color: #f0f8f0 !important; border: 1px solid #d4e6d4; }
        .autocomplete-list { position: absolute; z-index: 10; width: calc(100% - 2rem); max-height: 120px; overflow-y-auto; background: #fff; border: 1px solid #d4e6d4; border-radius: 4px; }
        .autocomplete-item { padding: 0.5rem; cursor: pointer; }
        .autocomplete-item:hover { background-color: #f0f8f0; }
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 100; display: flex; align-items: center; justify-content: center; }
        .modal-content { background: #fff; padding: 1.5rem; border-radius: 8px; width: 90%; max-width: 400px; }
        .modal-buttons { display: flex; gap: 1rem; justify-content: flex-end; margin-top: 1rem; }
        .motivation-modal { z-index: 200; }
        .motivation-content { text-align: center; padding: 1.5rem; }
        .motivation-title { font-size: 1.1rem !important; margin-bottom: 0.8rem !important; }
        .motivation-quote { font-size: 0.95rem !important; line-height: 1.5 !important; margin: 0.8rem 0 !important; font-weight: 400 !important; }
        .timer-display { font-size: 1.5rem; font-weight: bold; text-align: center; margin: 0.5rem 0; color: #065f46; }
        .timer-buttons { display: flex; gap: 0.5rem; justify-content: center; margin-top: 0.5rem; }
        .history-card { margin-top: 2rem; }
        .history-select { display: flex; gap: 1rem; align-items-center; margin-bottom: 1rem; }
        .history-list { max-height: 300px; overflow-y: auto; margin-top: 1rem; }
        .history-item { padding: 0.8rem; border-bottom: 1px solid #d4e6d4; cursor: pointer; transition: background-color 0.2s; }
        .history-item:hover { background-color: #f0f8f0; }
        .history-date { font-weight: 600; color: #065f46; }
        .history-total { color: #ef4444; }
        .total-stats-card { margin-top: 2rem; }
        .total-time-display { font-size: 1.8rem; font-weight: bold; text-align: center; color: #065f46; margin: 1rem 0; }
        .compare-card { margin-top: 2rem; }
        .compare-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-top: 1rem; }
        .compare-column { padding: 1rem; border-radius: 6px; background-color: #f0f8f0; }
        .compare-date { font-weight: 600; color: #065f46; margin-bottom: 0.5rem; }
        .compare-total { color: #ef4444; font-weight: 500; margin-bottom: 0.5rem; }
        .custom-compare-card { margin-top: 2rem; }
        .custom-compare-select { display: flex; gap: 1rem; align-items-center; margin-bottom: 1rem; flex-wrap: wrap; }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8">
    <!-- æ¯æ—¥åŠ±å¿—å¼¹çª—ï¼ˆé»˜è®¤æ˜¾ç¤ºï¼‰ -->
    <div id="motivationModal" class="modal motivation-modal">
        <div class="modal-content motivation-content">
            <h3 id="motivationTitle" class="text-xl font-bold motivation-title">ğŸ’ª ä»Šæ—¥è€ƒç ”å¯„è¯­</h3>
            <p id="dailyMotivation" class="motivation-quote"></p>
            <button id="startBtn" class="btn btn-primary">å¥½çš„åŠ æ²¹</button>
        </div>
    </div>
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-center text-emerald-800 mb-6">ğŸ“š 2028è€ƒç ”å¤‡è€ƒæ—¶é•¿ç»Ÿè®¡</h1>
        
        <!-- è‡ªå®šä¹‰å€’è®¡æ—¶åŒºåŸŸ -->
        <div class="card countdown-card mb-6">
            <h2 class="text-xl font-semibold text-emerald-700 mb-4">â° è‡ªå®šä¹‰å€’è®¡æ—¶ç®¡ç†</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium text-emerald-800 mb-1">é¡¹ç›®åç§°</label>
                    <input type="text" id="customCountdownName" class="input" placeholder="å¦‚ï¼šæ”¿æ²»å†²åˆºã€è‹±è¯­æ¨¡è€ƒ">
                </div>
                <div>
                    <label class="block text-sm font-medium text-emerald-800 mb-1">ç›®æ ‡æ—¥æœŸ</label>
                    <input type="date" id="customCountdownDate" class="input" min="" value="">
                </div>
                <div class="flex items-end">
                    <button id="addCustomCountdownBtn" class="btn btn-primary w-full">æ·»åŠ å€’è®¡æ—¶</button>
                </div>
            </div>
            <div id="customCountdownList" class="space-y-2">
                <!-- å€’è®¡æ—¶åˆ—è¡¨å°†åŠ¨æ€æ¸²æŸ“ -->
            </div>
        </div>

        <!-- è€ƒç ”å€’è®¡æ—¶åŒºåŸŸï¼ˆä¿ç•™ï¼‰ -->
        <div class="card countdown-card mb-6">
            <h2 class="text-xl font-semibold text-emerald-700 mb-2 text-center">â° 2028è€ƒç ”å€’è®¡æ—¶</h2>
            <div id="countdown" class="flex justify-center space-x-4 text-center text-emerald-900">
                <div class="flex flex-col">
                    <span id="days" class="text-2xl font-bold">00</span>
                    <span class="text-sm">å¤©</span>
                </div>
                <div class="flex flex-col">
                    <span id="hours" class="text-2xl font-bold">00</span>
                    <span class="text-sm">æ—¶</span>
                </div>
                <div class="flex flex-col">
                    <span id="minutes" class="text-2xl font-bold">00</span>
                    <span class="text-sm">åˆ†</span>
                </div>
                <div class="flex flex-col">
                    <span id="seconds" class="text-2xl font-bold">00</span>
                    <span class="text-sm">ç§’</span>
                </div>
            </div>
        </div>

        <!-- ä»Šæ—¥è®°å½•åŒºåŸŸï¼ˆæ­£å‘è®¡æ—¶+åŒæ¨¡å¼åˆ‡æ¢ï¼‰ -->
        <div class="card">
            <h2 class="text-xl font-semibold text-emerald-700 mb-4">ä»Šæ—¥å­¦ä¹ è®°å½•ï¼ˆ<span id="todayDate"></span>ï¼‰</h2>
            <!-- æ¨¡å¼åˆ‡æ¢ -->
            <div class="flex items-center mb-4 gap-4">
                <label class="text-emerald-800 font-medium">è®°å½•æ¨¡å¼ï¼š</label>
                <label class="inline-flex items-center gap-1">
                    <input type="radio" name="recordMode" value="manual" checked class="accent-emerald-600">
                    <span class="text-emerald-800">æ‰‹åŠ¨è¾“å…¥æ—¶é—´æ®µ</span>
                </label>
                <label class="inline-flex items-center gap-1">
                    <input type="radio" name="recordMode" value="timer" class="accent-emerald-600">
                    <span class="text-emerald-800">æ­£å‘è®¡æ—¶</span>
                </label>
            </div>
            <!-- æ‰‹åŠ¨è¾“å…¥æ¨¡å¼ï¼ˆé»˜è®¤æ˜¾ç¤ºï¼‰ -->
            <div id="manualMode" class="mb-4">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div class="relative">
                        <label class="block text-sm font-medium text-emerald-800 mb-1">å­¦ä¹ é¡¹ç›®</label>
                        <input type="text" id="stageName" class="input" placeholder="å¦‚ï¼šMTIç¿»è¯‘ã€æ”¿æ²»åˆ·é¢˜">
                        <div id="autocompleteContainer" class="autocomplete-list hidden"></div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-emerald-800 mb-1">å¼€å§‹æ—¶é—´</label>
                        <input type="time" id="startTime" class="input" value="08:00">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-emerald-800 mb-1">ç»“æŸæ—¶é—´</label>
                        <input type="time" id="endTime" class="input" value="09:00">
                    </div>
                    <div class="flex items-end">
                        <button id="addManualBtn" class="btn btn-primary w-full">æ·»åŠ è®°å½•</button>
                    </div>
                </div>
            </div>
            <!-- æ­£å‘è®¡æ—¶æ¨¡å¼ï¼ˆé»˜è®¤éšè—ï¼‰ -->
            <div id="timerMode" class="mb-4 hidden">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="relative md:col-span-1">
                        <label class="block text-sm font-medium text-emerald-800 mb-1">å­¦ä¹ é¡¹ç›®</label>
                        <input type="text" id="timerStageName" class="input" placeholder="å¦‚ï¼šMTIç¿»è¯‘ã€æ”¿æ²»åˆ·é¢˜">
                        <div id="timerAutocompleteContainer" class="autocomplete-list hidden"></div>
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-emerald-800 mb-1">å½“å‰è®¡æ—¶</label>
                        <div class="timer-display" id="timerDisplay">00:00:00</div>
                        <div class="timer-buttons">
                            <button id="startTimerBtn" class="btn btn-primary">å¼€å§‹è®¡æ—¶</button>
                            <button id="pauseTimerBtn" class="btn btn-warning" disabled>æš‚åœ</button>
                            <button id="stopTimerBtn" class="btn btn-danger" disabled>ç»“æŸå¹¶æ·»åŠ </button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- ä»Šæ—¥å­¦ä¹ åˆ—è¡¨ -->
            <div class="mb-4">
                <h3 class="text-md font-medium text-emerald-800 mb-2">ä»Šæ—¥å­¦ä¹ åˆ—è¡¨ï¼ˆå«æ—¶æ®µï¼‰</h3>
                <div id="stageList" class="max-h-40 overflow-y-auto space-y-2"></div>
            </div>
            <!-- ä»Šæ—¥æ€»æ—¶é•¿ -->
            <div class="flex justify-between items-center mb-6">
                <div>
                    <span class="text-emerald-800">ä»Šæ—¥æ€»æ—¶é•¿ï¼š</span>
                    <span id="todayTotal" class="text-xl font-bold text-emerald-600">0</span> åˆ†é’Ÿ
                </div>
                <button id="saveTodayBtn" class="btn btn-primary">ä¿å­˜ä»Šæ—¥è®°å½•</button>
            </div>
            <!-- ä»Šæ—¥æŸ±çŠ¶å›¾ -->
            <div id="todayChartContainer" class="h-60 hidden">
                <h3 class="text-md font-medium text-emerald-800 mb-2">ä»Šæ—¥å­¦ä¹ æ—¶æ®µåˆ†å¸ƒï¼ˆ24å°æ—¶ï¼‰</h3>
                <canvas id="todayChart"></canvas>
            </div>
        </div>

        <!-- å½“æ—¥æ˜¨æ—¥å¯¹æ¯”åŒºåŸŸ -->
        <div class="card compare-card">
            <h2 class="text-xl font-semibold text-emerald-700 mb-4">å½“æ—¥ vs æ˜¨æ—¥ å­¦ä¹ æ•ˆæœå¯¹æ¯”</h2>
            <div class="compare-grid">
                <div class="compare-column">
                    <div class="compare-date">ä»Šæ—¥ï¼ˆ<span id="todayCompareDate"></span>ï¼‰</div>
                    <div class="compare-total">æ€»æ—¶é•¿ï¼š<span id="todayCompareTotal">0</span> åˆ†é’Ÿ</div>
                    <div id="todayCompareStages" class="mt-2 space-y-1">
                        <!-- ä»Šæ—¥é¡¹ç›®åˆ—è¡¨å°†åŠ¨æ€æ¸²æŸ“ -->
                    </div>
                </div>
                <div class="compare-column">
                    <div class="compare-date">æ˜¨æ—¥ï¼ˆ<span id="yesterdayCompareDate"></span>ï¼‰</div>
                    <div class="compare-total">æ€»æ—¶é•¿ï¼š<span id="yesterdayCompareTotal">0</span> åˆ†é’Ÿ</div>
                    <div id="yesterdayCompareStages" class="mt-2 space-y-1">
                        <!-- æ˜¨æ—¥é¡¹ç›®åˆ—è¡¨å°†åŠ¨æ€æ¸²æŸ“ -->
                    </div>
                </div>
            </div>
            <div class="h-80 mt-4">
                <h3 class="text-md font-medium text-emerald-800 mb-2">æ—¶æ®µåˆ†å¸ƒå¯¹æ¯”</h3>
                <canvas id="compareChart"></canvas>
            </div>
        </div>

        <!-- ä»»æ„ä¸¤å¤©å¯¹æ¯”åŒºåŸŸ -->
        <div class="card custom-compare-card">
            <h2 class="text-xl font-semibold text-emerald-700 mb-4">ä»»æ„ä¸¤å¤©å­¦ä¹ æ•ˆæœå¯¹æ¯”</h2>
            <div class="custom-compare-select">
                <label class="block text-sm font-medium text-emerald-800 mb-1">é€‰æ‹©æ—¥æœŸ1</label>
                <input type="date" id="customCompareDate1" class="input w-48">
                <label class="block text-sm font-medium text-emerald-800 mb-1">é€‰æ‹©æ—¥æœŸ2</label>
                <input type="date" id="customCompareDate2" class="input w-48">
                <button id="viewCustomCompareBtn" class="btn btn-primary">æŸ¥çœ‹å¯¹æ¯”</button>
            </div>
            <div id="customCompareResult" class="hidden">
                <div class="compare-grid">
                    <div class="compare-column" id="customCompareCol1">
                        <div class="compare-date" id="customDate1">æ—¥æœŸ1</div>
                        <div class="compare-total" id="customTotal1">æ€»æ—¶é•¿ï¼š0 åˆ†é’Ÿ</div>
                        <div id="customStages1" class="mt-2 space-y-1">
                            <!-- æ—¥æœŸ1é¡¹ç›®åˆ—è¡¨å°†åŠ¨æ€æ¸²æŸ“ -->
                        </div>
                    </div>
                    <div class="compare-column" id="customCompareCol2">
                        <div class="compare-date" id="customDate2">æ—¥æœŸ2</div>
                        <div class="compare-total" id="customTotal2">æ€»æ—¶é•¿ï¼š0 åˆ†é’Ÿ</div>
                        <div id="customStages2" class="mt-2 space-y-1">
                            <!-- æ—¥æœŸ2é¡¹ç›®åˆ—è¡¨å°†åŠ¨æ€æ¸²æŸ“ -->
                        </div>
                    </div>
                </div>
                <div class="h-80 mt-4">
                    <h3 class="text-md font-medium text-emerald-800 mb-2">æ—¶æ®µåˆ†å¸ƒå¯¹æ¯”</h3>
                    <canvas id="customCompareChart"></canvas>
                </div>
            </div>
        </div>

        <!-- æœˆåº¦ç»Ÿè®¡åŒºåŸŸ -->
        <div class="card">
            <h2 class="text-xl font-semibold text-emerald-700 mb-4">æœˆåº¦å­¦ä¹ ç»Ÿè®¡</h2>
            <div class="flex justify-between items-center mb-4 flex-wrap gap-2">
                <div>
                    <label class="block text-sm font-medium text-emerald-800 mb-1">é€‰æ‹©æœˆä»½</label>
                    <input type="month" id="selectMonth" class="input w-48">
                </div>
                <button id="viewStatsBtn" class="btn btn-primary">æŸ¥çœ‹ç»Ÿè®¡</button>
            </div>
            <div class="h-80">
                <canvas id="monthlyChart"></canvas>
            </div>
        </div>

        <!-- å…¨é¡¹ç›®ç»Ÿè®¡åŒºåŸŸ -->
        <div class="card total-stats-card">
            <h2 class="text-xl font-semibold text-emerald-700 mb-4">å…¨é¡¹ç›®å­¦ä¹ æ—¶é•¿ç»Ÿè®¡</h2>
            <button id="calculateTotalTimeBtn" class="btn btn-primary mb-4">ä¸€é”®ç»Ÿè®¡æ‰€æœ‰å†å²æ—¶é•¿æ€»å’Œ</button>
            <div class="total-time-display" id="totalTimeDisplay">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®è®¡ç®—æ€»æ—¶é•¿</div>
            <div class="h-80 mt-4">
                <canvas id="allProjectsChart"></canvas>
            </div>
        </div>

        <!-- è¿‡å¾€è®°å½•æŸ¥è¯¢åŒºåŸŸ -->
        <div class="card history-card">
            <h2 class="text-xl font-semibold text-emerald-700 mb-4">è¿‡å¾€å­¦ä¹ è®°å½•æŸ¥è¯¢</h2>
            <div class="history-select">
                <label class="block text-sm font-medium text-emerald-800 mb-1">é€‰æ‹©æ—¥æœŸ</label>
                <input type="date" id="historyDate" class="input w-48">
                <button id="viewHistoryBtn" class="btn btn-primary">æŸ¥çœ‹è®°å½•</button>
            </div>
            <div id="historyList" class="history-list">
                <div class="text-center text-slate-500 py-4">è¯·é€‰æ‹©æ—¥æœŸåç‚¹å‡»â€œæŸ¥çœ‹è®°å½•â€</div>
            </div>
        </div>
    </div>

    <!-- å†å²è®°å½•è¯¦æƒ…å¼¹çª— -->
    <div id="historyDetailModal" class="modal hidden">
        <div class="modal-content">
            <h3 id="historyDetailTitle" class="text-lg font-semibold text-emerald-800 mb-2">å†å²è®°å½•è¯¦æƒ…</h3>
            <div id="historyDetailContent" class="mb-4">
                <p class="text-emerald-700 mb-2">æ—¥æœŸï¼š<span id="detailDate"></span></p>
                <p class="text-emerald-700 mb-2">æ€»æ—¶é•¿ï¼š<span id="detailTotal"></span> åˆ†é’Ÿ</p>
                <h4 class="text-md font-medium text-emerald-800 mb-2">å­¦ä¹ é¡¹ç›®åˆ—è¡¨</h4>
                <div id="detailStageList" class="space-y-2"></div>
            </div>
            <div class="modal-buttons">
                <button id="closeDetailBtn" class="btn btn-secondary">å…³é—­</button>
            </div>
        </div>
    </div>

    <!-- å¤‡ä»½å¯¹è¯æ¡†ï¼ˆé»˜è®¤éšè—ï¼‰ -->
    <div id="backupModal" class="modal hidden">
        <div class="modal-content">
            <h3 class="text-lg font-semibold text-emerald-800 mb-2">å¤‡ä»½ç½‘ç«™æ•°æ®</h3>
            <p class="text-emerald-700 mb-4">è¯·é€‰æ‹©ç›®æ ‡æ–‡ä»¶å¤¹ï¼Œå°†è‡ªåŠ¨è¦†ç›–æ—§æ–‡ä»¶</p>
            <div class="modal-buttons">
                <button id="cancelBackupBtn" class="btn btn-secondary">ç›´æ¥å…³é—­ï¼ˆä¸å¤‡ä»½ï¼‰</button>
                <button id="confirmBackupBtn" class="btn btn-primary">é€‰æ‹©æ–‡ä»¶å¤¹å¹¶å¤‡ä»½</button>
            </div>
        </div>
    </div>

    <script>
        // 1. æ¯æ—¥ä¸é‡å¤åŠ±å¿—è¯­å½•åº“ï¼ˆ50æ¡ï¼‰
        const motivationQuotes = [
            "æ¯ä¸€æ¬¡åˆ·é¢˜éƒ½æ˜¯åœ¨ä¸ºæ¢¦æƒ³é“ºè·¯ï¼Œä»Šå¤©çš„åšæŒï¼Œå°±æ˜¯æ˜å¤©çš„å½•å–é€šçŸ¥ä¹¦ï¼",
            "ä¸å¿…ç„¦è™‘è¿›åº¦ï¼Œä¸“æ³¨å½“ä¸‹çš„æ¯ä¸€åˆ†é’Ÿï¼Œæ—¶é—´ä¼šç»™ä½ æœ€å¥½çš„ç­”æ¡ˆã€‚",
            "è€ƒç ”å°±åƒé»‘å±‹å­é‡Œæ´—è¡£æœï¼Œä½ ä¸çŸ¥é“æ´—å¹²å‡€äº†æ²¡æœ‰ï¼Œåªèƒ½ä¸€éä¸€éå»æ´—ï¼Œç­‰ä¸Šäº†è€ƒåœºçš„é‚£ä¸€åˆ»ï¼Œç¯äº®äº†ï¼Œä½ å‘ç°æœ‰çš„äººå¿˜äº†åŠ æ´—è¡£ç²‰ï¼Œæœ‰çš„äººç”¨çš„æ˜¯æ´—è¡£æœºï¼Œä½†åªè¦ä½ è®¤çœŸæ´—è¿‡äº†æ¯ä¸€ä¸ªåœ°æ–¹ï¼Œé‚£ä»¶è¡£æœä¸€å®šæ˜¯æ´ç™½å¦‚æ–°çš„ï¼Œè€Œä½ ä»¥åæ¯æ¬¡ç©¿è¿™ä»¶è¡£æœæ—¶ï¼Œéƒ½ä¼šæƒ³èµ·é‚£æ®µå²æœˆã€‚",
            "ç°åœ¨å¤šå­¦ä¸€åˆ†é’Ÿï¼Œè€ƒåœºä¸Šå°±å¤šä¸€åˆ†åº•æ°”ï¼Œåˆ«è®©æœªæ¥çš„è‡ªå·±åæ‚”ç°åœ¨çš„æ‡ˆæ€ ã€‚",
            "é‚£äº›çœ‹ä¼¼ä¸èµ·æ³¢æ¾œçš„æ—¥å¤ä¸€æ—¥ï¼Œä¼šåœ¨æŸå¤©è®©ä½ çœ‹åˆ°åšæŒçš„æ„ä¹‰ã€‚",
            "è€ƒç ”ä¸æ˜¯è½»æ¾çš„æ—…ç¨‹ï¼Œä½†æ¯ä¸€æ­¥éƒ½ç®—æ•°ï¼Œä»Šå¤©çš„åŠªåŠ›ï¼Œç»ˆå°†ç…§äº®å‰è¡Œçš„è·¯ã€‚",
            "åˆ«å®³æ€•å›°éš¾ï¼Œä½ é‡åˆ°çš„æ¯ä¸€é“éš¾é¢˜ï¼Œéƒ½æ˜¯åœ¨ç­›é€‰çœŸæ­£æœ‰å†³å¿ƒçš„äººï¼Œè€Œä½ ï¼Œä¸€å®šæ˜¯å…¶ä¸­ä¹‹ä¸€ã€‚",
            "æŠŠç›®æ ‡åˆ»åœ¨å¿ƒé‡Œï¼ŒæŠŠåŠªåŠ›è½åœ¨å®å¤„ï¼Œç›¸ä¿¡è‡ªå·±ï¼Œä½ è¿œæ¯”æƒ³è±¡ä¸­æ›´å¼ºå¤§ã€‚",
            "æ¸…æ™¨çš„ä¹¦æ¡Œã€æ·±å¤œçš„ç¯å…‰ï¼Œéƒ½æ˜¯ä½ è¿½æ¢¦çš„è§è¯ï¼ŒåšæŒä¸‹å»ï¼Œç»ˆä¼šä¸Šå²¸ï¼",
            "ä¸ç”¨å’Œåˆ«äººæ¯”è¿›åº¦ï¼ŒæŒ‰è‡ªå·±çš„èŠ‚å¥ç¨³æ­¥å‰è¿›ï¼Œæ¯ä¸€ä¸ªè¸å®çš„è„šå°éƒ½ä¸ä¼šç™½èµ°ã€‚",
            "å­¦ä¹ å¾ˆç´¯ï¼Œä½†æ”¾å¼ƒæ›´å¯æƒœï¼Œå†åšæŒä¸€ä¸‹ï¼Œä½ ç¦»æ¢¦æƒ³å°±æ›´è¿‘ä¸€æ­¥ã€‚",
            "è€ƒç ”è·¯ä¸Šçš„å­¤ç‹¬ä¸ç–²æƒ«ï¼Œéƒ½ä¼šåœ¨æ”¶åˆ°å½•å–é€šçŸ¥çš„é‚£ä¸€åˆ»åŒ–ä¸ºå€¼å¾—ã€‚",
            "ä»Šå¤©ç¿»çš„ä¹¦ï¼Œå°±æ˜¯æ˜å¤©æ•°çš„é’±ï¼›ä»Šå¤©åƒçš„è‹¦ï¼Œå°±æ˜¯æ˜å¤©äº«çš„ç¦ã€‚",
            "ä¿æŒçƒ­çˆ±ï¼Œå¥”èµ´å±±æµ·ï¼Œè€ƒç ”æ˜¯ä¸€åœºè‡ªæˆ‘è¾ƒé‡ï¼Œèµ¢äº†è‡ªå·±ï¼Œå°±èµ¢äº†ä¸€åˆ‡ã€‚",
            "åˆ«ç»™è‡ªå·±æ‰¾å€Ÿå£ï¼Œç°åœ¨çš„æ¯ä¸€ä»½ä»˜å‡ºï¼Œéƒ½æ˜¯æœªæ¥çš„ç­¹ç ã€‚",
            "çœŸæ­£çš„å¯¹æ‰‹ä¸æ˜¯åˆ«äººï¼Œæ˜¯æ˜¨å¤©æ‡’æƒ°çš„è‡ªå·±ï¼Œæ¯å¤©è¿›æ­¥ä¸€ç‚¹ï¼Œå°±æ˜¯èƒœåˆ©ã€‚",
            "æ²¡æœ‰ä¸€è¹´è€Œå°±çš„æˆåŠŸï¼Œåªæœ‰æ—¥ç§¯æœˆç´¯çš„åŠªåŠ›ï¼Œè€ƒç ”åŠ æ²¹ï¼",
            "å½“ä½ æƒ³æ”¾å¼ƒæ—¶ï¼Œæƒ³æƒ³å½“åˆä¸ºä»€ä¹ˆå‡ºå‘ï¼Œåˆå¿ƒä¸æ”¹ï¼Œæ–¹èƒ½å§‹ç»ˆã€‚",
            "æ¯ä¸€ä¸ªæŒ‘ç¯å¤œè¯»çš„å¤œæ™šï¼Œéƒ½åœ¨ä¸ºä½ çš„æœªæ¥ç§¯æ”’å…‰èŠ’ã€‚",
            "è€ƒç ”æ˜¯ä¸€åœºæŒä¹…æˆ˜ï¼Œç†¬å¾—ä½å°±å‡ºä¼—ï¼Œç†¬ä¸ä½å°±å‡ºå±€ï¼Œä½ è¦åšé‚£ä¸ªå‡ºä¼—çš„äººã€‚",
            "çŸ¥è¯†ç‚¹è®°ä¸ä½å°±å¤šèƒŒå‡ éï¼Œé¢˜ä¸ä¼šåšå°±å¤šç»ƒå‡ é“ï¼ŒåšæŒä½ï¼Œèƒœåˆ©å°±åœ¨å‰æ–¹ã€‚",
            "ä¸ä¸ºæ¨¡ç³Šä¸æ¸…çš„æœªæ¥æ‹…å¿§ï¼Œåªä¸ºæ¸…æ¸…æ¥šæ¥šçš„ç°åœ¨åŠªåŠ›ã€‚",
            "ä½ çš„åšæŒï¼Œç»ˆå°†ç¾å¥½ï¼›ä½ çš„åŠªåŠ›ï¼Œå¿…æœ‰å›å“ã€‚",
            "è€ƒç ”å°±åƒçˆ¬å±±ï¼Œè¿‡ç¨‹å¾ˆç´¯ï¼Œä½†å±±é¡¶çš„é£æ™¯ä¸€å®šå€¼å¾—ã€‚",
            "ä»Šå¤©çš„æ±—æ°´ï¼Œæ˜¯æ˜å¤©çš„æ³ªæ°´ï¼ˆå–œæ‚¦çš„ï¼‰ï¼ŒåŠ æ²¹ï¼Œè€ƒç ”äººï¼",
            "åˆ«è®©ä»»ä½•äººæ¶ˆè€—ä½ å†…å¿ƒçš„æ™´æœ—ï¼Œç”Ÿæ´»åº”è¯¥æ˜¯è¢«çƒ­çˆ±çš„äººå’Œäº‹å¡«æ»¡çš„ï¼Œè€ƒç ”äº¦æ˜¯å¦‚æ­¤ã€‚",
            "åŠªåŠ›çš„æ„ä¹‰ï¼Œåœ¨äºå¯ä»¥é€‰æ‹©è‡ªå·±æƒ³è¦çš„ç”Ÿæ´»ï¼Œè€Œä¸æ˜¯è¢«è¿«æ¥å—ä¸æƒ³è¦çš„ã€‚",
            "æ¯ä¸€æ¬¡åšæŒï¼Œéƒ½æ˜¯å¯¹æ¢¦æƒ³çš„é è¿‘ï¼Œåˆ«è½»æ˜“æ”¾å¼ƒã€‚",
            "æˆåŠŸçš„è·¯ä¸Šå¹¶ä¸æ‹¥æŒ¤ï¼Œå› ä¸ºåšæŒçš„äººä¸å¤šï¼Œä½ å†åšæŒä¸€ä¸‹ï¼Œå°±èƒ½è¶…è¿‡å¾ˆå¤šäººã€‚",
            "æŠŠâ€œæˆ‘ä¸è¡Œâ€æ¢æˆâ€œæˆ‘å†è¯•è¯•â€ï¼Œä½ ä¼šå‘ç°è‡ªå·±è¿œæ¯”æƒ³è±¡ä¸­å¼ºå¤§ã€‚",
            "è€ƒç ”ä¸æ˜¯ä¸ºäº†é€ƒé¿ç°å®ï¼Œè€Œæ˜¯ä¸ºäº†ç»™è‡ªå·±æ›´å¤šé€‰æ‹©çš„æƒåˆ©ã€‚",
            "ç°åœ¨çš„è¾›è‹¦ï¼Œæ˜¯ä¸ºäº†ä»¥åèƒ½è½»æ¾åœ°é€‰æ‹©ï¼Œè€Œä¸æ˜¯è¢«è¿«åœ°æ¥å—ã€‚",
            "åˆ«æŠ±æ€¨å¤‡è€ƒçš„è‹¦ï¼Œé‚£æ˜¯ä½ å»çœ‹ä¸–ç•Œçš„è·¯ã€‚",
            "æ¯ä¸€ä¸ªæ—©èµ·çš„æ¸…æ™¨ï¼Œæ¯ä¸€ä¸ªæ™šç¡çš„æ·±å¤œï¼Œéƒ½åœ¨ä¹¦å†™ä½ çš„æœªæ¥ã€‚",
            "åšæŒä¸‹å»ï¼Œä¸æ˜¯å› ä¸ºçœ‹åˆ°äº†å¸Œæœ›ï¼Œè€Œæ˜¯å› ä¸ºåŠªåŠ›äº†æ‰èƒ½çœ‹åˆ°å¸Œæœ›ã€‚",
            "è€ƒç ”è·¯ä¸Šï¼Œä½ ä¸æ˜¯ä¸€ä¸ªäººåœ¨æˆ˜æ–—ï¼Œè¿˜æœ‰åƒåƒä¸‡ä¸‡çš„ç ”å‹å’Œä½ ä¸€èµ·å‰è¡Œã€‚",
            "çŸ¥è¯†ä¸ä¼šè¾œè´ŸåŠªåŠ›çš„äººï¼Œä½ ä»Šå¤©å­¦çš„æ¯ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼Œéƒ½ä¼šåœ¨è€ƒåœºä¸Šå¸®åˆ°ä½ ã€‚",
            "åˆ«çº ç»“äºè¿‡å»çš„å¤±è¯¯ï¼Œä¸“æ³¨äºå½“ä¸‹çš„å­¦ä¹ ï¼Œæœªæ¥è¿˜å¯ä»¥æ”¹å˜ã€‚",
            "ç»™è‡ªå·±ä¸€ä¸ªç›®æ ‡ï¼Œç„¶åä¸ºä¹‹å¥‹æ–—ï¼Œä½ ä¼šå‘ç°è‡ªå·±çš„æ½œåŠ›æ— é™ã€‚",
            "è€ƒç ”çš„æ„ä¹‰ä¸åœ¨äºç»“æœï¼Œè€Œåœ¨äºè¿‡ç¨‹ä¸­ä½ æˆä¸ºäº†æ›´å¥½çš„è‡ªå·±ã€‚",
            "ç´¯äº†å°±ä¼‘æ¯ä¸€ä¸‹ï¼Œä½†åˆ«æ”¾å¼ƒï¼Œè°ƒæ•´å¥½çŠ¶æ€å†ç»§ç»­å‡ºå‘ã€‚",
            "ä»Šå¤©å¤šå­¦ä¸€ç‚¹ï¼Œæ˜å¤©å°±å°‘æ…Œä¸€ç‚¹ï¼Œè€ƒç ”åŠ æ²¹ï¼Œä½ å¯ä»¥çš„ï¼",
            "æ²¡æœ‰ç™½è´¹çš„åŠªåŠ›ï¼Œä¹Ÿæ²¡æœ‰ç¢°å·§çš„æˆåŠŸï¼Œæ¯ä¸€æ­¥éƒ½å¾ˆé‡è¦ã€‚",
            "æŠŠè€ƒç ”å½“æˆä¸€åœºä¿®è¡Œï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ç£¨ç»ƒè‡ªå·±çš„æ„å¿—ï¼Œæå‡è‡ªå·±çš„èƒ½åŠ›ã€‚",
            "åˆ«è®©æ‡’æƒ°å æ®ä½ çš„ç”Ÿæ´»ï¼Œè¡ŒåŠ¨èµ·æ¥ï¼Œä¸ºè‡ªå·±çš„æœªæ¥æ‹¼æã€‚",
            "ä½ ç°åœ¨çš„åŠªåŠ›ï¼Œæ˜¯ä¸ºäº†ä»¥åèƒ½æœ‰æ›´å¤šçš„åº•æ°”è¯´â€œæˆ‘å¯ä»¥â€ã€‚",
            "è€ƒç ”å°±åƒä¸€åœºé©¬æ‹‰æ¾ï¼Œä¸åœ¨äºèµ·è·‘å¤šå¿«ï¼Œè€Œåœ¨äºèƒ½å¦åšæŒåˆ°æœ€åã€‚",
            "æ¯ä¸€ä¸ªçŸ¥è¯†ç‚¹çš„æŒæ¡ï¼Œæ¯ä¸€é“é¢˜çš„æ”»å…‹ï¼Œéƒ½æ˜¯ä½ è¿›æ­¥çš„è¯æ˜ã€‚",
            "ç›¸ä¿¡è‡ªå·±ï¼Œä½ æœ‰èƒ½åŠ›å®ç°è‡ªå·±çš„æ¢¦æƒ³ï¼Œåªè¦ä½ æ„¿æ„ä»˜å‡ºåŠªåŠ›ã€‚"
        ];
        // æ¯æ—¥éšæœºå¼¹çª—é¢œè‰²ï¼ˆæŠ¤çœ¼è‰²ç³»ï¼‰
        const randomColors = [
            '#065f46', '#10b981', '#059669', '#047857', '#34d399', 
            '#1e40af', '#3b82f6', '#2563eb', '#1d4ed8', '#3b82f6'
        ];
        const getRandomColor = () => {
            const today = new Date();
            const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24));
            return randomColors[dayOfYear % randomColors.length];
        };
        // åˆå§‹åŒ–åŠ±å¿—å¼¹çª—
        const motivationModal = document.getElementById('motivationModal');
        const motivationTitle = document.getElementById('motivationTitle');
        const dailyMotivation = document.getElementById('dailyMotivation');
        const motivationColor = getRandomColor();
        motivationTitle.style.color = motivationColor;
        dailyMotivation.style.color = motivationColor;
        dailyMotivation.textContent = motivationQuotes[Math.floor(Math.random() * motivationQuotes.length)];
        document.getElementById('startBtn').addEventListener('click', () => {
            motivationModal.classList.add('hidden');
        });

        // 2. åŸºç¡€æ—¥æœŸåˆå§‹åŒ–
        const today = new Date();
        const formatDate = (date) => date.toISOString().split('T')[0];
        const formatMonth = (date) => date.toISOString().split('-').slice(0,2).join('-');
        document.getElementById('todayDate').textContent = formatDate(today);
        document.getElementById('todayCompareDate').textContent = formatDate(today);
        const yesterday = new Date(today);
        yesterday.setDate(today.getDate() - 1);
        document.getElementById('yesterdayCompareDate').textContent = formatDate(yesterday);
        document.getElementById('selectMonth').value = formatMonth(today);
        document.getElementById('historyDate').value = formatDate(today);
        document.getElementById('customCountdownDate').min = formatDate(today);

        // 3. è€ƒç ”å€’è®¡æ—¶
        const targetDate = new Date('2027-12-24T08:30:00');
        const updateCountdown = () => {
            const now = new Date();
            const diff = targetDate - now;
            if (diff <= 0) {
                document.getElementById('days').textContent = '00';
                document.getElementById('hours').textContent = '00';
                document.getElementById('minutes').textContent = '00';
                document.getElementById('seconds').textContent = '00';
                return;
            }
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            document.getElementById('days').textContent = days.toString().padStart(2, '0');
            document.getElementById('hours').textContent = hours.toString().padStart(2, '0');
            document.getElementById('minutes').textContent = minutes.toString().padStart(2, '0');
            document.getElementById('seconds').textContent = seconds.toString().padStart(2, '0');
        };
        updateCountdown();
        setInterval(updateCountdown, 1000);

        // 4. è‡ªå®šä¹‰å€’è®¡æ—¶åŠŸèƒ½
        let customCountdowns = JSON.parse(localStorage.getItem('CustomCountdowns')) || [];
        const renderCustomCountdowns = () => {
            const listEl = document.getElementById('customCountdownList');
            listEl.innerHTML = customCountdowns.map((countdown, index) => `
                <div class="flex items-center justify-between p-2 bg-emerald-50 rounded-md border border-emerald-100">
                    <div>
                        <span class="text-emerald-900 font-medium">${countdown.name}</span>
                        <div id="customCountdown${index}" class="text-sm text-emerald-700">è®¡ç®—ä¸­...</div>
                    </div>
                    <button class="text-rose-500 hover:text-rose-600" onclick="removeCustomCountdown(${index})">åˆ é™¤</button>
                </div>
            `).join('');
            // å®æ—¶æ›´æ–°æ¯ä¸ªå€’è®¡æ—¶
            customCountdowns.forEach((countdown, index) => {
                const now = new Date();
                const target = new Date(countdown.date);
                const diff = target - now;
                if (diff <= 0) {
                    document.getElementById(`customCountdown${index}`).textContent = 'å·²ç»“æŸ';
                    return;
                }
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                document.getElementById(`customCountdown${index}`).textContent = 
                    `${days}å¤©${hours}æ—¶${minutes}åˆ†`;
            });
        };
        window.removeCustomCountdown = (index) => {
            customCountdowns.splice(index, 1);
            localStorage.setItem('CustomCountdowns', JSON.stringify(customCountdowns));
            renderCustomCountdowns();
        };
        document.getElementById('addCustomCountdownBtn').addEventListener('click', () => {
            const name = document.getElementById('customCountdownName').value.trim();
            const date = document.getElementById('customCountdownDate').value;
            if (!name || !date) {
                alert('è¯·å¡«å†™é¡¹ç›®åç§°å’Œç›®æ ‡æ—¥æœŸ');
                return;
            }
            customCountdowns.push({ name, date });
            localStorage.setItem('CustomCountdowns', JSON.stringify(customCountdowns));
            document.getElementById('customCountdownName').value = '';
            renderCustomCountdowns();
        });
        renderCustomCountdowns();

        // 5. æœ¬åœ°å­˜å‚¨é…ç½®
        const STORAGE_KEY = '2028PostgradStudyRecord';
        const STAGE_NAMES_KEY = '2028PostgradStageNames';
        let todayStages = [];
        let studyData = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
        let stageNames = JSON.parse(localStorage.getItem(STAGE_NAMES_KEY)) || [];

        // 6. å›¾è¡¨åˆå§‹åŒ–ï¼ˆæœˆåº¦é¥¼å›¾+ä»Šæ—¥æŸ±çŠ¶å›¾+å…¨é¡¹ç›®é¥¼å›¾+å¯¹æ¯”æŸ±çŠ¶å›¾ï¼‰
        // æœˆåº¦é¥¼å›¾
        const monthlyCtx = document.getElementById('monthlyChart').getContext('2d');
        let monthlyChart = new Chart(monthlyCtx, {
            type: 'pie',
            data: {
                labels: [],
                datasets: [{
                    data: [],
                    backgroundColor: ['#10b981', '#6ee7b7', '#34d399', '#059669', '#047857', '#065f46', '#064e3b'],
                    borderWidth: 1,
                    borderColor: '#f0f8f0'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'right', labels: { color: '#065f46' } },
                    title: { display: true, text: 'æœˆåº¦å­¦ä¹ æ—¶é•¿åˆ†å¸ƒ', font: { size: 16, color: '#065f46' } }
                }
            }
        });

        // ä»Šæ—¥æŸ±çŠ¶å›¾
        const todayCtx = document.getElementById('todayChart').getContext('2d');
        let todayChart = new Chart(todayCtx, {
            type: 'bar',
            data: {
                labels: Array.from({length:24}, (_,i) => `${i}:00`),
                datasets: [{
                    label: 'ä»Šæ—¥å­¦ä¹ é¢‘ç‡ï¼ˆåˆ†é’Ÿ/å°æ—¶ï¼‰',
                    data: Array(24).fill(0),
                    backgroundColor: '#34d399',
                    borderRadius: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: { beginAtZero: true, title: { display: true, text: 'æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰', color: '#065f46' } },
                    x: { title: { display: true, text: 'æ—¶é—´æ®µ', color: '#065f46' } }
                },
                plugins: { legend: { display: false } }
            }
        });

        // å…¨é¡¹ç›®é¥¼å›¾
        const allProjectsCtx = document.getElementById('allProjectsChart').getContext('2d');
        let allProjectsChart = new Chart(allProjectsCtx, {
            type: 'pie',
            data: {
                labels: [],
                datasets: [{
                    data: [],
                    backgroundColor: ['#10b981', '#6ee7b7', '#34d399', '#059669', '#047857', '#065f46', '#064e3b'],
                    borderWidth: 1,
                    borderColor: '#f0f8f0'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'right', labels: { color: '#065f46' } },
                    title: { display: true, text: 'æ‰€æœ‰å­¦ä¹ é¡¹ç›®æ—¶é•¿åˆ†å¸ƒ', font: { size: 16, color: '#065f46' } }
                }
            }
        });

        // å½“æ—¥æ˜¨æ—¥å¯¹æ¯”æŸ±çŠ¶å›¾
        const compareCtx = document.getElementById('compareChart').getContext('2d');
        let compareChart = new Chart(compareCtx, {
            type: 'bar',
            data: {
                labels: Array.from({length:24}, (_,i) => `${i}:00`),
                datasets: [
                    {
                        label: 'ä»Šæ—¥',
                        data: Array(24).fill(0),
                        backgroundColor: '#34d399',
                        borderRadius: 4
                    },
                    {
                        label: 'æ˜¨æ—¥',
                        data: Array(24).fill(0),
                        backgroundColor: '#6ee7b7',
                        borderRadius: 4
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: { beginAtZero: true, title: { display: true, text: 'æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰', color: '#065f46' } },
                    x: { title: { display: true, text: 'æ—¶é—´æ®µ', color: '#065f46' } }
                }
            }
        });

        // ä»»æ„ä¸¤å¤©å¯¹æ¯”æŸ±çŠ¶å›¾
        const customCompareCtx = document.getElementById('customCompareChart').getContext('2d');
        let customCompareChart = new Chart(customCompareCtx, {
            type: 'bar',
            data: {
                labels: Array.from({length:24}, (_,i) => `${i}:00`),
                datasets: [
                    {
                        label: 'æ—¥æœŸ1',
                        data: Array(24).fill(0),
                        backgroundColor: '#34d399',
                        borderRadius: 4
                    },
                    {
                        label: 'æ—¥æœŸ2',
                        data: Array(24).fill(0),
                        backgroundColor: '#6ee7b7',
                        borderRadius: 4
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: { beginAtZero: true, title: { display: true, text: 'æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰', color: '#065f46' } },
                    x: { title: { display: true, text: 'æ—¶é—´æ®µ', color: '#065f46' } }
                }
            }
        });

        // 7. é¡¹ç›®åè‡ªåŠ¨è”æƒ³ï¼ˆæ‰‹åŠ¨æ¨¡å¼+è®¡æ—¶æ¨¡å¼ï¼‰
        // æ‰‹åŠ¨æ¨¡å¼è”æƒ³
        const stageNameInput = document.getElementById('stageName');
        const autocompleteContainer = document.getElementById('autocompleteContainer');
        // è®¡æ—¶æ¨¡å¼è”æƒ³
        const timerStageNameInput = document.getElementById('timerStageName');
        const timerAutocompleteContainer = document.getElementById('timerAutocompleteContainer');
        // è”æƒ³åŠŸèƒ½é€šç”¨æ–¹æ³•
        const renderAutocomplete = (inputVal, container) => {
            if (!inputVal) {
                container.classList.add('hidden');
                return;
            }
            const matches = stageNames.filter(name => name.toLowerCase().includes(inputVal.toLowerCase()));
            if (matches.length === 0) {
                container.classList.add('hidden');
                return;
            }
            container.innerHTML = matches.map(name => 
                `<div class="autocomplete-item" onclick="selectStageName('${name}','${container.id}')">${name}</div>`
            ).join('');
            container.classList.remove('hidden');
        };
        // é€‰æ‹©è”æƒ³é¡¹
        window.selectStageName = (name, containerId) => {
            if (containerId === 'autocompleteContainer') {
                stageNameInput.value = name;
                autocompleteContainer.classList.add('hidden');
            } else {
                timerStageNameInput.value = name;
                timerAutocompleteContainer.classList.add('hidden');
            }
        };
        // æ‰‹åŠ¨æ¨¡å¼è¾“å…¥ç›‘å¬
        stageNameInput.addEventListener('input', () => {
            renderAutocomplete(stageNameInput.value, autocompleteContainer);
        });
        // è®¡æ—¶æ¨¡å¼è¾“å…¥ç›‘å¬
        timerStageNameInput.addEventListener('input', () => {
            renderAutocomplete(timerStageNameInput.value, timerAutocompleteContainer);
        });
        // ç‚¹å‡»ç©ºç™½å…³é—­è”æƒ³æ¡†
        document.addEventListener('click', (e) => {
            if (!stageNameInput.contains(e.target) && !autocompleteContainer.contains(e.target)) {
                autocompleteContainer.classList.add('hidden');
            }
            if (!timerStageNameInput.contains(e.target) && !timerAutocompleteContainer.contains(e.target)) {
                timerAutocompleteContainer.classList.add('hidden');
            }
        });

        // 8. æ¨¡å¼åˆ‡æ¢é€»è¾‘ï¼ˆæ‰‹åŠ¨/æ­£å‘è®¡æ—¶ï¼‰
        const manualMode = document.getElementById('manualMode');
        const timerMode = document.getElementById('timerMode');
        const recordModeRadios = document.querySelectorAll('input[name="recordMode"]');
        recordModeRadios.forEach(radio => {
            radio.addEventListener('change', () => {
                if (radio.value === 'manual') {
                    manualMode.classList.remove('hidden');
                    timerMode.classList.add('hidden');
                } else {
                    manualMode.classList.add('hidden');
                    timerMode.classList.remove('hidden');
                }
            });
        });

        // 9. æ‰‹åŠ¨è¾“å…¥æ¨¡å¼ - è®¡ç®—æ—¶é•¿ä¸æ·»åŠ è®°å½•
        const calculateDuration = (start, end) => {
            const [startH, startM] = start.split(':').map(Number);
            const [endH, endM] = end.split(':').map(Number);
            const startTotal = startH * 60 + startM;
            const endTotal = endH * 60 + endM;
            return endTotal >= startTotal ? endTotal - startTotal : (endTotal + 1440) - startTotal;
        };
        // æ¸²æŸ“ä»Šæ—¥å­¦ä¹ åˆ—è¡¨
        const renderStageList = () => {
            const listEl = document.getElementById('stageList');
            listEl.innerHTML = todayStages.map((stage, index) => `
                <div class="flex items-center justify-between p-2 bg-emerald-50 rounded-md border border-emerald-100">
                    <div>
                        <span class="text-emerald-900 font-medium">${stage.name}</span>
                        <span class="text-emerald-700 text-sm ml-2">${stage.startTime} - ${stage.endTime}</span>
                        <span class="text-emerald-600 ml-2">(${stage.duration}åˆ†é’Ÿ)</span>
                    </div>
                    <button class="text-rose-500 hover:text-rose-600" onclick="removeStage(${index})">åˆ é™¤</button>
                </div>
            `).join('');
            // æ›´æ–°ä»Šæ—¥æ€»æ—¶é•¿
            const total = todayStages.reduce((sum, s) => sum + s.duration, 0);
            document.getElementById('todayTotal').textContent = total;
        };
        // åˆ é™¤å­¦ä¹ è®°å½•ï¼ˆåˆ é™¤åç«‹å³åŒæ­¥ä¿å­˜ï¼Œè®°å½•å½»åº•æ¶ˆå¤±ï¼‰
        window.removeStage = (index) => {
            todayStages.splice(index, 1);
            renderStageList();
            // åŒæ­¥æ›´æ–°æœ¬åœ°å­˜å‚¨
            const todayKey = formatDate(today);
            studyData[todayKey] = { stages: [...todayStages], total: todayStages.reduce((sum, s) => sum + s.duration, 0), date: todayKey };
            localStorage.setItem(STORAGE_KEY, JSON.stringify(studyData));
        };
        // æ‰‹åŠ¨æ·»åŠ è®°å½•
        document.getElementById('addManualBtn').addEventListener('click', () => {
            const name = stageNameInput.value.trim();
            const startTime = document.getElementById('startTime').value;
            const endTime = document.getElementById('endTime').value;
            if (!name || !startTime || !endTime) {
                alert('è¯·å¡«å†™å®Œæ•´å­¦ä¹ é¡¹ç›®å’Œæ—¶é—´æ®µ');
                return;
            }
            const duration = calculateDuration(startTime, endTime);
            if (duration < 1) {
                alert('æ—¶é•¿éœ€å¤§äº1åˆ†é’Ÿ');
                return;
            }
            // ç¼“å­˜é¡¹ç›®åï¼ˆå»é‡ï¼‰
            if (!stageNames.includes(name)) {
                stageNames.push(name);
                localStorage.setItem(STAGE_NAMES_KEY, JSON.stringify(stageNames));
            }
            // æ·»åŠ åˆ°ä»Šæ—¥åˆ—è¡¨
            todayStages.push({ name, startTime, endTime, duration });
            stageNameInput.value = '';
            renderStageList();
        });

        // 10. æ­£å‘è®¡æ—¶æ¨¡å¼ - è®¡æ—¶é€»è¾‘
        let timerInterval = null;
        let timerSeconds = 0;
        const timerDisplay = document.getElementById('timerDisplay');
        const startTimerBtn = document.getElementById('startTimerBtn');
        const pauseTimerBtn = document.getElementById('pauseTimerBtn');
        const stopTimerBtn = document.getElementById('stopTimerBtn');
        // æ ¼å¼åŒ–æ—¶é—´ï¼ˆç§’è½¬æ—¶åˆ†ç§’ï¼‰
        const formatTimer = (seconds) => {
            const h = Math.floor(seconds / 3600).toString().padStart(2, '0');
            const m = Math.floor((seconds % 3600) / 60).toString().padStart(2, '0');
            const s = (seconds % 60).toString().padStart(2, '0');
            return `${h}:${m}:${s}`;
        };
        // å¼€å§‹è®¡æ—¶
        startTimerBtn.addEventListener('click', () => {
            timerInterval = setInterval(() => {
                timerSeconds++;
                timerDisplay.textContent = formatTimer(timerSeconds);
            }, 1000);
            startTimerBtn.disabled = true;
            pauseTimerBtn.disabled = false;
            stopTimerBtn.disabled = false;
        });
        // æš‚åœè®¡æ—¶
        pauseTimerBtn.addEventListener('click', () => {
            clearInterval(timerInterval);
            startTimerBtn.disabled = false;
            pauseTimerBtn.disabled = true;
        });
        // ç»“æŸè®¡æ—¶å¹¶æ·»åŠ è®°å½•
        stopTimerBtn.addEventListener('click', () => {
            clearInterval(timerInterval);
            const name = timerStageNameInput.value.trim();
            if (!name) {
                alert('è¯·å¡«å†™å­¦ä¹ é¡¹ç›®åç§°');
                // é‡ç½®è®¡æ—¶çŠ¶æ€
                timerSeconds = 0;
                timerDisplay.textContent = '00:00:00';
                startTimerBtn.disabled = false;
                pauseTimerBtn.disabled = true;
                stopTimerBtn.disabled = true;
                return;
            }
            // è®¡ç®—å¼€å§‹/ç»“æŸæ—¶é—´ï¼ˆå½“å‰æ—¶é—´å€’æ¨æ—¶é•¿ï¼‰
            const endTime = new Date();
            const startTime = new Date(endTime - timerSeconds * 1000);
            // æ ¼å¼åŒ–æ—¶é—´ä¸º HH:MM
            const formatTime = (date) => date.toTimeString().slice(0, 5);
            const startStr = formatTime(startTime);
            const endStr = formatTime(endTime);
            const duration = Math.floor(timerSeconds / 60); // è½¬åˆ†é’Ÿï¼ˆä¸è¶³1åˆ†é’ŸæŒ‰1åˆ†é’Ÿç®—ï¼‰
            
            // ç¼“å­˜é¡¹ç›®åï¼ˆå»é‡ï¼‰
            if (!stageNames.includes(name)) {
                stageNames.push(name);
                localStorage.setItem(STAGE_NAMES_KEY, JSON.stringify(stageNames));
            }
            // æ·»åŠ åˆ°ä»Šæ—¥åˆ—è¡¨
            todayStages.push({ name, startTime: startStr, endTime: endStr, duration: duration || 1 });
            // é‡ç½®è®¡æ—¶çŠ¶æ€
            timerSeconds = 0;
            timerDisplay.textContent = '00:00:00';
            timerStageNameInput.value = '';
            startTimerBtn.disabled = false;
            pauseTimerBtn.disabled = true;
            stopTimerBtn.disabled = true;
            // é‡æ–°æ¸²æŸ“åˆ—è¡¨
            renderStageList();
        });

        // 11. ä¿å­˜ä»Šæ—¥è®°å½•
        document.getElementById('saveTodayBtn').addEventListener('click', () => {
            if (todayStages.length === 0) {
                alert('ä»Šæ—¥æš‚æ— å­¦ä¹ è®°å½•å¯ä¿å­˜');
                return;
            }
            const todayKey = formatDate(today);
            const total = todayStages.reduce((sum, s) => sum + s.duration, 0);
            studyData[todayKey] = { stages: [...todayStages], total, date: todayKey };
            localStorage.setItem(STORAGE_KEY, JSON.stringify(studyData));
            
            // ç”Ÿæˆä»Šæ—¥æ—¶æ®µåˆ†å¸ƒæ•°æ®
            const hourData = Array(24).fill(0);
            todayStages.forEach(stage => {
                const [startH, startM] = stage.startTime.split(':').map(Number);
                const [endH, endM] = stage.endTime.split(':').map(Number);
                const startTotal = startH * 60 + startM;
                const endTotal = endH * 60 + endM;
                
                if (endTotal >= startTotal) {
                    // åŒä¸€æ—¶æ®µå†…
                    for (let m = startTotal; m < endTotal; m++) {
                        const hour = Math.floor(m / 60);
                        hourData[hour]++;
                    }
                } else {
                    // è·¨å‡Œæ™¨
                    for (let m = startTotal; m < 1440; m++) {
                        const hour = Math.floor(m / 60);
                        hourData[hour]++;
                    }
                    for (let m = 0; m < endTotal; m++) {
                        const hour = Math.floor(m / 60);
                        hourData[hour]++;
                    }
                }
            });
            todayChart.data.datasets[0].data = hourData;
            todayChart.update();
            document.getElementById('todayChartContainer').classList.remove('hidden');
            alert('ä»Šæ—¥è®°å½•ä¿å­˜æˆåŠŸï¼');
        });

        // 12. æœˆåº¦ç»Ÿè®¡æŸ¥è¯¢
        document.getElementById('viewStatsBtn').addEventListener('click', () => {
            const selectedMonth = document.getElementById('selectMonth').value;
            if (!selectedMonth) return;
            // ç­›é€‰å½“æœˆè®°å½•
            const monthRecords = Object.entries(studyData).filter(([date]) => date.startsWith(selectedMonth));
            if (monthRecords.length === 0) {
                monthlyChart.data.labels = ['æ— æ•°æ®'];
                monthlyChart.data.datasets[0].data = [1];
                monthlyChart.update();
                return;
            }
            // ç»Ÿè®¡å„é¡¹ç›®æ€»æ—¶é•¿
            const stageStats = {};
            monthRecords.forEach(([_, data]) => {
                data.stages.forEach(stage => {
                    stageStats[stage.name] = (stageStats[stage.name] || 0) + stage.duration;
                });
            });
            // æ›´æ–°å›¾è¡¨
            monthlyChart.data.labels = Object.keys(stageStats);
            monthlyChart.data.datasets[0].data = Object.values(stageStats);
            const totalMonthTime = Object.values(stageStats).reduce((a, b) => a + b, 0);
            monthlyChart.options.plugins.title.text = `${selectedMonth} å­¦ä¹ æ—¶é•¿åˆ†å¸ƒï¼ˆæ€»ï¼š${totalMonthTime}åˆ†é’Ÿï¼‰`;
            monthlyChart.update();
        });

        // 13. å…¨é¡¹ç›®ç»Ÿè®¡
        document.getElementById('calculateTotalTimeBtn').addEventListener('click', () => {
            let totalMinutes = 0;
            Object.values(studyData).forEach(data => {
                totalMinutes += data.total;
            });
            const hours = Math.floor(totalMinutes / 60);
            const minutes = totalMinutes % 60;
            document.getElementById('totalTimeDisplay').textContent = `æ€»æ—¶é•¿ï¼š${hours}å°æ—¶${minutes}åˆ†é’Ÿ`;
            
            // ç»Ÿè®¡æ‰€æœ‰é¡¹ç›®æ€»æ—¶é•¿
            const allProjectsStats = {};
            Object.values(studyData).forEach(data => {
                data.stages.forEach(stage => {
                    allProjectsStats[stage.name] = (allProjectsStats[stage.name] || 0) + stage.duration;
                });
            });
            allProjectsChart.data.labels = Object.keys(allProjectsStats);
            allProjectsChart.data.datasets[0].data = Object.values(allProjectsStats);
            allProjectsChart.update();
        });

        // 14. è¿‡å¾€è®°å½•æŸ¥è¯¢åŠŸèƒ½
        // æ¸²æŸ“å†å²è®°å½•åˆ—è¡¨
        const renderHistoryList = () => {
            const historyListEl = document.getElementById('historyList');
            if (Object.keys(studyData).length === 0) {
                historyListEl.innerHTML = '<div class="text-center text-slate-500 py-4">æš‚æ— å†å²è®°å½•</div>';
                return;
            }
            // æŒ‰æ—¥æœŸå€’åºæ’åˆ—
            const sortedDates = Object.keys(studyData).sort((a, b) => new Date(b) - new Date(a));
            historyListEl.innerHTML = sortedDates.map(date => {
                const data = studyData[date];
                return `
                    <div class="history-item" onclick="showHistoryDetail('${date}')">
                        <div class="history-date">${date}</div>
                        <div>æ€»æ—¶é•¿ï¼š<span class="history-total">${data.total}åˆ†é’Ÿ</span></div>
                    </div>
                `;
            }).join('');
        };
        // æŸ¥çœ‹å†å²è®°å½•è¯¦æƒ…
        window.showHistoryDetail = (date) => {
            const data = studyData[date];
            if (!data) return;
            document.getElementById('detailDate').textContent = date;
            document.getElementById('detailTotal').textContent = data.total;
            const detailStageListEl = document.getElementById('detailStageList');
            detailStageListEl.innerHTML = data.stages.map(stage => `
                <div class="p-2 bg-emerald-50 rounded-md border border-emerald-100">
                    <span class="text-emerald-900 font-medium">${stage.name}</span>
                    <span class="text-emerald-700 text-sm ml-2">${stage.startTime} - ${stage.endTime}</span>
                    <span class="text-emerald-600 ml-2">(${stage.duration}åˆ†é’Ÿ)</span>
                </div>
            `).join('');
            document.getElementById('historyDetailModal').classList.remove('hidden');
        };
        // ç»‘å®šæŸ¥çœ‹å†å²è®°å½•æŒ‰é’®
        document.getElementById('viewHistoryBtn').addEventListener('click', () => {
            const selectedDate = document.getElementById('historyDate').value;
            if (!selectedDate) {
                renderHistoryList();
                return;
            }
            if (studyData[selectedDate]) {
                showHistoryDetail(selectedDate);
            } else {
                alert('è¯¥æ—¥æœŸæ— è®°å½•ï¼Œè¯·é€‰æ‹©å…¶ä»–æ—¥æœŸæˆ–æŸ¥çœ‹å…¨éƒ¨å†å²è®°å½•');
                renderHistoryList();
            }
        });
        // å…³é—­è¯¦æƒ…å¼¹çª—
        document.getElementById('closeDetailBtn').addEventListener('click', () => {
            document.getElementById('historyDetailModal').classList.add('hidden');
        });
        // åˆå§‹åŒ–å†å²è®°å½•åˆ—è¡¨
        renderHistoryList();

        // 15. å½“æ—¥æ˜¨æ—¥å¯¹æ¯”åŠŸèƒ½
        const renderTodayYesterdayCompare = () => {
            const todayKey = formatDate(today);
            const yesterdayKey = formatDate(yesterday);
            const todayData = studyData[todayKey] || { stages: [], total: 0 };
            const yesterdayData = studyData[yesterdayKey] || { stages: [], total: 0 };
            
            document.getElementById('todayCompareTotal').textContent = todayData.total;
            document.getElementById('yesterdayCompareTotal').textContent = yesterdayData.total;
            
            const todayStagesEl = document.getElementById('todayCompareStages');
            todayStagesEl.innerHTML = todayData.stages.map(stage => `
                <div class="text-sm">${stage.name}ï¼ˆ${stage.duration}åˆ†é’Ÿï¼‰</div>
            `).join('');
            
            const yesterdayStagesEl = document.getElementById('yesterdayCompareStages');
            yesterdayStagesEl.innerHTML = yesterdayData.stages.map(stage => `
                <div class="text-sm">${stage.name}ï¼ˆ${stage.duration}åˆ†é’Ÿï¼‰</div>
            `).join('');
            
            // ç”Ÿæˆæ—¶æ®µå¯¹æ¯”æ•°æ®
            const todayHourData = Array(24).fill(0);
            if (todayData.stages) {
                todayData.stages.forEach(stage => {
                    const [startH, startM] = stage.startTime.split(':').map(Number);
                    const [endH, endM] = stage.endTime.split(':').map(Number);
                    const startTotal = startH * 60 + startM;
                    const endTotal = endH * 60 + endM;
                    
                    if (endTotal >= startTotal) {
                        for (let m = startTotal; m < endTotal; m++) {
                            const hour = Math.floor(m / 60);
                            todayHourData[hour]++;
                        }
                    } else {
                        for (let m = startTotal; m < 1440; m++) {
                            const hour = Math.floor(m / 60);
                            todayHourData[hour]++;
                        }
                        for (let m = 0; m < endTotal; m++) {
                            const hour = Math.floor(m / 60);
                            todayHourData[hour]++;
                        }
                    }
                });
            }
            
            const yesterdayHourData = Array(24).fill(0);
            if (yesterdayData.stages) {
                yesterdayData.stages.forEach(stage => {
                    const [startH, startM] = stage.startTime.split(':').map(Number);
                    const [endH, endM] = stage.endTime.split(':').map(Number);
                    const startTotal = startH * 60 + startM;
                    const endTotal = endH * 60 + endM;
                    
                    if (endTotal >= startTotal) {
                        for (let m = startTotal; m < endTotal; m++) {
                            const hour = Math.floor(m / 60);
                            yesterdayHourData[hour]++;
                        }
                    } else {
                        for (let m = startTotal; m < 1440; m++) {
                            const hour = Math.floor(m / 60);
                            yesterdayHourData[hour]++;
                        }
                        for (let m = 0; m < endTotal; m++) {
                            const hour = Math.floor(m / 60);
                            yesterdayHourData[hour]++;
                        }
                    }
                });
            }
            
            compareChart.data.datasets[0].data = todayHourData;
            compareChart.data.datasets[1].data = yesterdayHourData;
            compareChart.update();
        };
        renderTodayYesterdayCompare();

        // 16. ä»»æ„ä¸¤å¤©å¯¹æ¯”åŠŸèƒ½
        document.getElementById('viewCustomCompareBtn').addEventListener('click', () => {
            const date1 = document.getElementById('customCompareDate1').value;
            const date2 = document.getElementById('customCompareDate2').value;
            if (!date1 || !date2) {
                alert('è¯·é€‰æ‹©ä¸¤ä¸ªæ—¥æœŸ');
                return;
            }
            const data1 = studyData[date1] || { stages: [], total: 0, date: date1 };
            const data2 = studyData[date2] || { stages: [], total: 0, date: date2 };
            
            document.getElementById('customDate1').textContent = date1;
            document.getElementById('customDate2').textContent = date2;
            document.getElementById('customTotal1').textContent = `æ€»æ—¶é•¿ï¼š${data1.total} åˆ†é’Ÿ`;
            document.getElementById('customTotal2').textContent = `æ€»æ—¶é•¿ï¼š${data2.total} åˆ†é’Ÿ`;
            
            const stages1El = document.getElementById('customStages1');
            stages1El.innerHTML = data1.stages.map(stage => `
                <div class="text-sm">${stage.name}ï¼ˆ${stage.duration}åˆ†é’Ÿï¼‰</div>
            `).join('');
            
            const stages2El = document.getElementById('customStages2');
            stages2El.innerHTML = data2.stages.map(stage => `
                <div class="text-sm">${stage.name}ï¼ˆ${stage.duration}åˆ†é’Ÿï¼‰</div>
            `).join('');
            
            // ç”Ÿæˆæ—¶æ®µå¯¹æ¯”æ•°æ®
            const hourData1 = Array(24).fill(0);
            if (data1.stages) {
                data1.stages.forEach(stage => {
                    const [startH, startM] = stage.startTime.split(':').map(Number);
                    const [endH, endM] = stage.endTime.split(':').map(Number);
                    const startTotal = startH * 60 + startM;
                    const endTotal = endH * 60 + endM;
                    
                    if (endTotal >= startTotal) {
                        for (let m = startTotal; m < endTotal; m++) {
                            const hour = Math.floor(m / 60);
                            hourData1[hour]++;
                        }
                    } else {
                        for (let m = startTotal; m < 1440; m++) {
                            const hour = Math.floor(m / 60);
                            hourData1[hour]++;
                        }
                        for (let m = 0; m < endTotal; m++) {
                            const hour = Math.floor(m / 60);
                            hourData1[hour]++;
                        }
                    }
                });
            }
            
            const hourData2 = Array(24).fill(0);
            if (data2.stages) {
                data2.stages.forEach(stage => {
                    const [startH, startM] = stage.startTime.split(':').map(Number);
                    const [endH, endM] = stage.endTime.split(':').map(Number);
                    const startTotal = startH * 60 + startM;
                    const endTotal = endH * 60 + endM;
                    
                    if (endTotal >= startTotal) {
                        for (let m = startTotal; m < endTotal; m++) {
                            const hour = Math.floor(m / 60);
                            hourData2[hour]++;
                        }
                    } else {
                        for (let m = startTotal; m < 1440; m++) {
                            const hour = Math.floor(m / 60);
                            hourData2[hour]++;
                        }
                        for (let m = 0; m < endTotal; m++) {
                            const hour = Math.floor(m / 60);
                            hourData2[hour]++;
                        }
                    }
                });
            }
            
            customCompareChart.data.datasets[0].data = hourData1;
            customCompareChart.data.datasets[1].data = hourData2;
            customCompareChart.update();
            document.getElementById('customCompareResult').classList.remove('hidden');
        });

        // 17. åˆå§‹åŒ–ä»Šæ—¥è®°å½•
        const initTodayRecords = () => {
            const todayKey = formatDate(today);
            if (studyData[todayKey]) {
                todayStages = [...studyData[todayKey].stages];
                renderStageList();
                // åˆå§‹åŒ–ä»Šæ—¥æŸ±çŠ¶å›¾
                const hourData = Array(24).fill(0);
                todayStages.forEach(stage => {
                    const [startH, startM] = stage.startTime.split(':').map(Number);
                    const [endH, endM] = stage.endTime.split(':').map(Number);
                    const startTotal = startH * 60 + startM;
                    const endTotal = endH * 60 + endM;
                    if (endTotal >= startTotal) {
                        for (let m = startTotal; m < endTotal; m++) {
                            const hour = Math.floor(m / 60);
                            hourData[hour]++;
                        }
                    } else {
                        for (let m = startTotal; m < 1440; m++) {
                            const hour = Math.floor(m / 60);
                            hourData[hour]++;
                        }
                        for (let m = 0; m < endTotal; m++) {
                            const hour = Math.floor(m / 60);
                            hourData[hour]++;
                        }
                    }
                });
                todayChart.data.datasets[0].data = hourData;
                todayChart.update();
                document.getElementById('todayChartContainer').classList.remove('hidden');
            }
        };
        initTodayRecords();
        document.getElementById('viewStatsBtn').click();

        // 18. å…³é—­é¡µé¢å¤‡ä»½åŠŸèƒ½
        const backupModal = document.getElementById('backupModal');
        const cancelBackupBtn = document.getElementById('cancelBackupBtn');
        const confirmBackupBtn = document.getElementById('confirmBackupBtn');
        let isBackupCompleted = false;
        // æ˜¾ç¤ºå¤‡ä»½å¯¹è¯æ¡†
        const showBackupModal = () => {
            backupModal.classList.remove('hidden');
        };
        // å–æ¶ˆå¤‡ä»½å¹¶å…³é—­
        cancelBackupBtn.addEventListener('click', () => {
            backupModal.classList.add('hidden');
            isBackupCompleted = true;
            window.close();
        });
        // ç¡®è®¤å¤‡ä»½ï¼ˆé€‰æ‹©æ–‡ä»¶å¤¹+è¦†ç›–æ—§æ–‡ä»¶ï¼‰
        confirmBackupBtn.addEventListener('click', async () => {
            try {
                const htmlContent = document.documentElement.outerHTML;
                const blob = new Blob([htmlContent], { type: 'text/html' });
                // è§¦å‘ç³»ç»Ÿæ–‡ä»¶é€‰æ‹©å™¨
                const handle = await window.showSaveFilePicker({
                    suggestedName: 'è€ƒç ”æ—¶é•¿ç»Ÿè®¡.html',
                    types: [{
                        description: 'HTMLæ–‡ä»¶',
                        accept: { 'text/html': ['.html'] }
                    }],
                    excludeAcceptAllOption: true
                });
                // è¦†ç›–å†™å…¥æ–‡ä»¶
                const writable = await handle.createWritable({ keepExistingData: false });
                await writable.write(blob);
                await writable.close();
                backupModal.classList.add('hidden');
                isBackupCompleted = true;
                alert('å¤‡ä»½æˆåŠŸï¼å·²è¦†ç›–ç›®æ ‡æ–‡ä»¶å¤¹æ—§æ–‡ä»¶');
                window.close();
            } catch (err) {
                alert('å¤‡ä»½å–æ¶ˆæˆ–å¤±è´¥ï¼š' + err.message);
            }
        });
        // ç›‘å¬é¡µé¢å…³é—­äº‹ä»¶
        window.addEventListener('beforeunload', (e) => {
            if (isBackupCompleted) return;
            e.preventDefault();
            e.returnValue = '';
            showBackupModal();
            return e.returnValue;
        });
    </script>
</body>
</html>